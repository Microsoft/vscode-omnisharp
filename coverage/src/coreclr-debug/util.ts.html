<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/coreclr-debug/util.ts</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../prettify.css">
    <link rel="stylesheet" href="../../base.css">
    <style type='text/css'>
        div.coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class="header low">
    <h1>Code coverage report for <span class="entity">src/coreclr-debug/util.ts</span></h1>
    <h2>
        Statements: <span class="metric">40% <small>(24 / 60)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Branches: <span class="metric">13.64% <small>(3 / 22)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Functions: <span class="metric">31.25% <small>(5 / 16)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Lines: <span class="metric">40% <small>(24 / 60)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../index.html">All files</a> &#187; <a href="index.html">src/coreclr-debug/</a> &#187; util.ts</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
'use strict';
&nbsp;
import * as path from 'path';
import * as fs from 'fs';
import * as semver from 'semver';
import * as os from 'os';
import { execChildProcess } from './../common';
import { Logger } from './../logger';
&nbsp;
const MINIMUM_SUPPORTED_DOTNET_CLI: string = '1.0.0-preview2-003121';
&nbsp;
export class DotnetInfo
{
    public Version: string;
    public OsVersion: string;
    public RuntimeId: string;
}
&nbsp;
export class DotNetCliError extends Error {
    public ErrorMessage: string; // the message to display to the user
    public ErrorString: string; // the string to log for this error
}
&nbsp;
export class CoreClrDebugUtil
{
    private _extensionDir: string = '';
    private _debugAdapterDir: string = '';
    private _installCompleteFilePath: string = '';
&nbsp;
    constructor(extensionDir: string, logger: Logger) {
        this._extensionDir = extensionDir;
        this._debugAdapterDir = path.join(this._extensionDir, '.debugger');
        this._installCompleteFilePath = path.join(this._debugAdapterDir, 'install.complete');
    }
&nbsp;
    public extensionDir<span class="fstat-no" title="function not covered" >(): string {</span>
<span class="cstat-no" title="statement not covered" >        if (this._extensionDir === '')</span>
        {
<span class="cstat-no" title="statement not covered" >            throw new Error('Failed to set extension directory');</span>
        }
<span class="cstat-no" title="statement not covered" >        return this._extensionDir;</span>
    }
&nbsp;
    public debugAdapterDir(): string {
        <span class="missing-if-branch" title="if path not taken" >I</span>if (this._debugAdapterDir === '') {
<span class="cstat-no" title="statement not covered" >            throw new Error('Failed to set debugadpter directory');</span>
        }
        return this._debugAdapterDir;
    }
&nbsp;
    public installCompleteFilePath(): string {
        <span class="missing-if-branch" title="if path not taken" >I</span>if (this._installCompleteFilePath === '')
        {
<span class="cstat-no" title="statement not covered" >            throw new Error('Failed to set install complete file path');</span>
        }
        return this._installCompleteFilePath;
    }
&nbsp;
    public static writeEmptyFile(path: string<span class="fstat-no" title="function not covered" >) : Promise&lt;void&gt; {</span>
<span class="cstat-no" title="statement not covered" >        return new Promise&lt;void&gt;((resolve, reject) =&gt;<span class="fstat-no" title="function not covered" > {</span></span>
<span class="cstat-no" title="statement not covered" >            fs.writeFile(path, '', (err) =&gt;<span class="fstat-no" title="function not covered" > {</span></span>
<span class="cstat-no" title="statement not covered" >                if (err) {</span>
<span class="cstat-no" title="statement not covered" >                    reject(err.code);</span>
                } else {
<span class="cstat-no" title="statement not covered" >                    resolve();</span>
                }
            });
        });
    }
&nbsp;
    public defaultDotNetCliErrorMessage<span class="fstat-no" title="function not covered" >(): string {</span>
<span class="cstat-no" title="statement not covered" >        return 'Failed to find up to date dotnet cli on the path.';</span>
    }
&nbsp;
    // This function checks for the presence of dotnet on the path and ensures the Version
    // is new enough for us. 
    // Returns: a promise that returns a DotnetInfo class
    // Throws: An DotNetCliError() from the return promise if either dotnet does not exist or is too old. 
    public checkDotNetCli<span class="fstat-no" title="function not covered" >(): Promise&lt;DotnetInfo&gt;</span>
    {
        let dotnetInfo = <span class="cstat-no" title="statement not covered" >new DotnetInfo();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        return execChildProcess('dotnet --info', process.cwd())</span>
        .then((data: string) =&gt;<span class="fstat-no" title="function not covered" > {</span>
            let lines: string[] = <span class="cstat-no" title="statement not covered" >data.replace(/\r/mg, '').split('\n');</span>
<span class="cstat-no" title="statement not covered" >            lines.forEach(line =&gt;<span class="fstat-no" title="function not covered" > {</span></span>
                let match: RegExpMatchArray;
<span class="cstat-no" title="statement not covered" >                if (match = /^\ Version:\s*([^\s].*)$/.exec(line)) {</span>
<span class="cstat-no" title="statement not covered" >                    dotnetInfo.Version = match[1];</span>
                } else <span class="cstat-no" title="statement not covered" >if (match = /^\ OS Version:\s*([^\s].*)$/.exec(line)) {</span>
<span class="cstat-no" title="statement not covered" >                    dotnetInfo.OsVersion = match[1];</span>
                } else <span class="cstat-no" title="statement not covered" >if (match = /^\ RID:\s*([\w\-\.]+)$/.exec(line)) {</span>
<span class="cstat-no" title="statement not covered" >                    dotnetInfo.RuntimeId = match[1];</span>
                }
            });
        }).catch((error) =&gt;<span class="fstat-no" title="function not covered" > {</span>
            // something went wrong with spawning 'dotnet --info'
            let dotnetError = <span class="cstat-no" title="statement not covered" >new DotNetCliError();</span>
<span class="cstat-no" title="statement not covered" >            dotnetError.ErrorMessage = 'The .NET CLI tools cannot be located. .NET Core debugging will not be enabled. Make sure .NET CLI tools are installed and are on the path.';</span>
<span class="cstat-no" title="statement not covered" >            dotnetError.ErrorString = "Failed to spawn 'dotnet --info'";</span>
<span class="cstat-no" title="statement not covered" >            throw dotnetError;</span>
        }).then(() =&gt;<span class="fstat-no" title="function not covered" > {</span>
            // succesfully spawned 'dotnet --info', check the Version
<span class="cstat-no" title="statement not covered" >            if (semver.lt(dotnetInfo.Version, MINIMUM_SUPPORTED_DOTNET_CLI))</span>
            {
                let dotnetError = <span class="cstat-no" title="statement not covered" >new DotNetCliError();</span>
<span class="cstat-no" title="statement not covered" >                dotnetError.ErrorMessage = 'The .NET CLI tools on the path are too old. .NET Core debugging will not be enabled. The minimum supported version is ' + MINIMUM_SUPPORTED_DOTNET_CLI + '.';</span>
<span class="cstat-no" title="statement not covered" >                dotnetError.ErrorString = "dotnet cli is too old";</span>
<span class="cstat-no" title="statement not covered" >                throw dotnetError;</span>
            }
&nbsp;
<span class="cstat-no" title="statement not covered" >            return dotnetInfo;</span>
        });
    }
&nbsp;
    public static isMacOSSupported<span class="fstat-no" title="function not covered" >() : boolean {</span>
        // .NET Core 2.0 requires macOS 10.12 (Sierra), which is Darwin 16.0+
        // Darwin version chart: https://en.wikipedia.org/wiki/Darwin_(operating_system)
<span class="cstat-no" title="statement not covered" >        return semver.gte(os.release(), "16.0.0");</span>
    }
&nbsp;
    public static existsSync(path: string) : boolean {
        try {
            fs.accessSync(path, fs.constants.F_OK);
            return true;
        } catch (err) {
<span class="cstat-no" title="statement not covered" >            if (err.code === 'ENOENT' || err.code === 'ENOTDIR') {</span>
<span class="cstat-no" title="statement not covered" >                return false;</span>
            } else {
<span class="cstat-no" title="statement not covered" >                throw Error(err.code);</span>
            }
        }
    }
&nbsp;
    public static getPlatformExeExtension() : string {
        <span class="missing-if-branch" title="if path not taken" >I</span>if (process.platform === 'win32') {
<span class="cstat-no" title="statement not covered" >            return '.exe';</span>
        }
&nbsp;
        return '';
    }
}
&nbsp;</pre></td></tr>
</table></pre>

</div>
<div class="footer">
    <div class="meta">Generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Fri Mar 09 2018 19:23:26 GMT-0800 (PST)</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
